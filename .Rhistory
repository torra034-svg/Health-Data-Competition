hcris <- read_dta(file = "C:/Users/Lenovo/Downloads/hcris (1).dta")
library(tidyverse)
library(haven)
hcris <- read_dta(file = "C:/Users/Lenovo/Downloads/hcris (1).dta")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
library(haven)
# Chunk 3
hcris <- read_dta(file = "C:/Users/Lenovo/Downloads/hcris (1).dta")
hcahps <- read_dta(file = "C:/Users/Lenovo/Downloads/hcahps (1).dta")
poc <- read_dta(file = "C:/Users/Lenovo/Downloads/poc (1).dta")
mort <- read_dta(file = "C:/Users/Lenovo/Downloads/mortreadm.dta")
# Chunk 4: hcris
hcris <- hcris %>%
select(pn, year, ccr_wtd)
# Chunk 5: hcahps
hcahps <- hcahps %>%
select(pn, year, overall_score)
# Chunk 6: mort
mort <- mort %>%
select(pn, year, pn_mort_rate)
# Chunk 7: poc
poc <- poc %>%
select(pn, year, ami1_share, ed1_minutes, ed2_minutes, op22_share)
# Chunk 8: join hchaps and hcris
df_h <- inner_join(hcahps, hcris, by = c("pn","year")) %>%
filter(!is.na(overall_score) & !is.na(ccr_wtd))
# Chunk 9: join mort and poc
df_m <- full_join(mort, poc, by = c("pn","year"))
# Chunk 10: complete dataset
df <- full_join(df_h,df_m, by = c("pn","year"))
view(df)
# Chunk 11
df1 <- df %>%
select(-pn_mort_rate, -ami1_share) %>%  ## I want to focus on predictor variables that I think are significant to the story we are telling
filter(!is.na(overall_score)
& !is.na(ed1_minutes)
& !is.na(ed2_minutes)
& !is.na(op22_share))
view(df1)
rm(df_h, df_m, hcahps, hcris, mort, poc)
df1 <- df %>%
select(-pn_mort_rate, -ami1_share) %>%  ## I want to focus on predictor variables that I think are significant to the story we are telling
filter(!is.na(overall_score)
& !is.na(ed1_minutes)
& !is.na(ed2_minutes)
& !is.na(op22_share)) %>%
filter(year >= 2015)
view(df1)
ggplot(df1, aes(x = ccr_wtd, y = overall_score)) +
geom_point()
model <- lm(data = df1, overall_score ~ ccr_wtd)
summary(model)
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
rm(model)
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
par(mfrow = c(2, 2))
plot(model)
library(tidyverse)
library(haven)
library(car)
vif(model)
vif(model)
vif(model)
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
# Create a grid for ccr_wtd
newdata <- data.frame(
ccr_wtd = seq(min(df1$ccr_wtd), max(df1$ccr_wtd), length.out = 100),
ed1_minutes = mean(df1$ed1_minutes),
ed2_minutes = mean(df1$ed2_minutes),
op22_share = mean(df1$op22_share)
)
# Add predicted values
newdata$overall_pred <- predict(model, newdata)
ggplot(df1, aes(x = ccr_wtd, y = overall_score)) +
geom_point(alpha = 0.5) +
geom_line(data = newdata, aes(x = ccr_wtd, y = overall_pred), color = "blue", linewidth = 1.2) +
labs(
title = "Effect of CCR on Overall Score",
subtitle = "Holding other predictors at their mean",
x = "CCR Weighted",
y = "Overall Score"
) +
theme_minimal()
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2: library
library(tidyverse)
library(haven)
library(car)
# Chunk 3
hcris <- read_dta(file = "C:/Users/Lenovo/Downloads/hcris (1).dta")
hcahps <- read_dta(file = "C:/Users/Lenovo/Downloads/hcahps (1).dta")
poc <- read_dta(file = "C:/Users/Lenovo/Downloads/poc (1).dta")
mort <- read_dta(file = "C:/Users/Lenovo/Downloads/mortreadm.dta")
# Chunk 4: hcris
hcris <- hcris %>%
select(pn, year, ccr_wtd)
# Chunk 5: hcahps
hcahps <- hcahps %>%
select(pn, year, overall_score)
# Chunk 6: mort
mort <- mort %>%
select(pn, year, pn_mort_rate)
# Chunk 7: poc
poc <- poc %>%
select(pn, year, ami1_share, ed1_minutes, ed2_minutes, op22_share)
# Chunk 8: join hchaps and hcris
df_h <- inner_join(hcahps, hcris, by = c("pn","year")) %>%
filter(!is.na(overall_score) & !is.na(ccr_wtd))
# Chunk 9: join mort and poc
df_m <- full_join(mort, poc, by = c("pn","year"))
# Chunk 10: complete dataset
df <- full_join(df_h,df_m, by = c("pn","year"))
# Chunk 11: df1
df1 <- df %>%
select(-pn_mort_rate, -ami1_share) %>%  ## I want to focus on predictor variables that I think are significant to the story we are telling
filter(!is.na(overall_score)
& !is.na(ed1_minutes)
& !is.na(ed2_minutes)
& !is.na(op22_share)) %>%
filter(year >= 2016) # want to get data from last decade
view(df1)
# Chunk 12: remove orig datasets to save space
rm(df_h, df_m, hcahps, hcris, mort, poc, df)
# Chunk 13: multiple linear regression model (MLR)
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
# Chunk 14: diagnostic plots
par(mfrow = c(2, 2))
plot(model)
# Chunk 15: multicollinearity
vif(model)
# Chunk 16: prediction
# Create a grid for ccr_wtd
newdata <- data.frame(
ccr_wtd = seq(min(df1$ccr_wtd), max(df1$ccr_wtd), length.out = 100),
ed1_minutes = mean(df1$ed1_minutes),
ed2_minutes = mean(df1$ed2_minutes),
op22_share = mean(df1$op22_share)
)
# Add predicted values
newdata$overall_pred <- predict(model, newdata)
# Chunk 17: prediction plot
ggplot(df1, aes(x = ccr_wtd, y = overall_score)) +
geom_point(alpha = 0.5) +
geom_line(data = newdata, aes(x = ccr_wtd, y = overall_pred), color = "blue", linewidth = 1.2) +
labs(
title = "Effect of CCR on Overall Score",
subtitle = "Holding other predictors at their mean",
x = "CCR Weighted",
y = "Overall Score"
) +
theme_minimal()
model <- lm(data = df1, overall_score ~ ccr_wtd + ed1_minutes + ed2_minutes + op22_share)
summary(model)
